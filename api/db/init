// api/db/init.js
export default async function handler(request) {
  if (request.method !== 'POST') {
    return new Response('Method not allowed', { status: 405 });
  }

  try {
    // Step 1: Drop tables
    const dropResponse = await fetch(
      `${process.env.VERCEL_URL}/api/db/drop`, 
      { method: 'POST' }
    );
    if (!dropResponse.ok) {
      throw new Error('Failed to drop tables');
    }

    // Step 2: Create schema
    const schemaResponse = await fetch(
      `${process.env.VERCEL_URL}/api/db/schema`,
      { method: 'POST' }
    );
    if (!schemaResponse.ok) {
      throw new Error('Failed to create schema');
    }

    // Step 3: Seed data
    const seedResponse = await fetch(
      `${process.env.VERCEL_URL}/api/db/seed`,
      { method: 'POST' }
    );
    if (!seedResponse.ok) {
      throw new Error('Failed to seed data');
    }

    return new Response(JSON.stringify({ 
      success: true,
      message: 'Database initialized successfully'
    }), {
      headers: { 'Content-Type': 'application/json' }
    });

  } catch (error) {
    console.error('Database initialization failed:', error);
    return new Response(JSON.stringify({ 
      success: false,
      error: error.message 
    }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' }
    });
  }
}
